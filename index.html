<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bearbeitbarer Kalender</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f4;
        }
        h1 {
            margin: 20px;
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            max-width: 800px;
            margin-bottom: 10px;
        }
        .calendar-header button {
            padding: 5px 15px;
            background-color: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .calendar-header button:hover {
            background-color: #1769aa;
        }
        .calendar-header span {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #ddd;
            width: 90%;
            max-width: 800px;
        }
        .day, .weekday {
            background-color: #fff;
            padding: 10px;
            text-align: center;
            border: 1px solid #ccc;
            position: relative;
        }
        .weekday {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .day {
            height: auto;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
        }
        .day span {
            font-weight: bold;
        }
        .events-container {
            margin-top: 5px;
            display: flex;
            flex-direction: column;
            gap: 3px;
            width: 100%;
        }
        .event {
            background: #2196F3;
            color: #fff;
            padding: 3px;
            font-size: 12px;
            border-radius: 3px;
            cursor: pointer;
        }
        .event:hover {
            background: #1769aa;
        }
        #eventModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            border-radius: 8px;
        }
        #eventModal input, #eventModal select, #eventModal button {
            margin-top: 10px;
            display: block;
        }
        #modalBackdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
    </style>
</head>
<body>

<h1>Bearbeitbarer Kalender</h1>
<div class="calendar-header">
    <button id="prevMonth">← Vorheriger Monat</button>
    <span id="currentMonth"></span>
    <button id="nextMonth">Nächster Monat →</button>
</div>
<div class="calendar" id="calendar"></div>

<div id="modalBackdrop"></div>
<div id="eventModal">
    <h2>Termin hinzufügen/bearbeiten</h2>
    <input type="text" id="eventTitle" placeholder="Titel des Termins" />
    <label for="eventStartTime">Von:</label>
    <input type="time" id="eventStartTime" />
    <label for="eventEndTime">Bis:</label>
    <input type="time" id="eventEndTime" />
    <label for="eventColor">Farbe:</label>
    <select id="eventColor">
        <option value="#2196F3" style="color: #2196F3;">Blau</option>
        <option value="#F44336" style="color: #F44336;">Rot</option>
        <option value="#4CAF50" style="color: #4CAF50;">Grün</option>
        <option value="#FF9800" style="color: #FF9800;">Orange</option>
    </select>
    <button id="saveEvent">Speichern</button>
    <button id="cancelEvent">Abbrechen</button>
</div>

<!-- Firebase-Skripte -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>

<script>
    // Firebase-Konfiguration
    const firebaseConfig = {
        apiKey: "AIzaSyDAHyermfy978ysuXNFEmECLfYrTexTTFo",
        authDomain: "neueakte.firebaseapp.com",
        projectId: "neueakte",
        storageBucket: "neueakte.firebasestorage.app",
        messagingSenderId: "179230045821",
        appId: "1:179230045821:web:bbd2b5f8734f68dfd26314",
        measurementId: "G-3MYK0CQ04E"
    };

    // Firebase initialisieren
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database(app);

    const calendar = document.getElementById('calendar');
    const modal = document.getElementById('eventModal');
    const backdrop = document.getElementById('modalBackdrop');
    const eventTitleInput = document.getElementById('eventTitle');
    const eventStartTimeInput = document.getElementById('eventStartTime');
    const eventEndTimeInput = document.getElementById('eventEndTime');
    const eventColorSelect = document.getElementById('eventColor');
    const saveEventButton = document.getElementById('saveEvent');
    const cancelEventButton = document.getElementById('cancelEvent');
    const currentMonthSpan = document.getElementById('currentMonth');
    const prevMonthButton = document.getElementById('prevMonth');
    const nextMonthButton = document.getElementById('nextMonth');

    let selectedDay = null;
    let currentYear = 2025;
    let currentMonth = 0; // Januar
    const months = [
        "Januar", "Februar", "März", "April", "Mai", "Juni",
        "Juli", "August", "September", "Oktober", "November", "Dezember"
    ];
    const weekdays = ["Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag", "Sonntag"];

    function updateCalendarHeader() {
        currentMonthSpan.textContent = `${months[currentMonth]} ${currentYear}`;
    }

    function generateCalendar() {
        calendar.innerHTML = '';
        weekdays.forEach(day => {
            const weekdayElement = document.createElement('div');
            weekdayElement.className = 'weekday';
            weekdayElement.textContent = day;
            calendar.appendChild(weekdayElement);
        });

        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const startDay = (new Date(currentYear, currentMonth, 1).getDay() + 6) % 7;

        for (let i = 0; i < startDay; i++) {
            calendar.appendChild(document.createElement('div'));
        }
        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            dayElement.className = 'day';
            dayElement.innerHTML = `<span>${day}</span><div class="events-container" id="day-${day}"></div>`;
            dayElement.addEventListener('click', () => openModal(dayElement, day));
            calendar.appendChild(dayElement);
        }
        loadEvents();
    }

    function openModal(dayElement, day) {
        selectedDay = dayElement.querySelector('.events-container');
        eventTitleInput.value = '';
        eventStartTimeInput.value = '';
        eventEndTimeInput.value = '';
        modal.style.display = 'block';
        backdrop.style.display = 'block';
        saveEventButton.onclick = () => saveEvent(day);
    }

    function closeModal() {
        modal.style.display = 'none';
        backdrop.style.display = 'none';
    }

    function saveEvent(day) {
        const eventTitle = eventTitleInput.value;
        const eventStartTime = eventStartTimeInput.value;
        const eventEndTime = eventEndTimeInput.value;
        const eventColor = eventColorSelect.value;

        if (eventTitle && eventStartTime && eventEndTime) {
            const newEvent = {
                title: eventTitle,
                startTime: eventStartTime,
                endTime: eventEndTime,
                color: eventColor
            };

            const dayRef = database.ref(`events/${currentYear}/${currentMonth + 1}/${day}`);
            dayRef.push(newEvent).then(() => {
                loadEvents();
                closeModal();
            });
        } else {
            alert("Bitte alle Felder ausfüllen.");
        }
    }

    function loadEvents() {
        const eventsRef = database.ref(`events/${currentYear}/${currentMonth + 1}`);
        eventsRef.once('value').then(snapshot => {
            const events = snapshot.val();
            if (events) {
                Object.keys(events).forEach(day => {
                    const dayContainer = document.getElementById(`day-${day}`);
                    dayContainer.innerHTML = `<span>${day}</span><div class="events-container" id="day-${day}"></div>`;
                    const eventsContainer = document.getElementById(`day-${day}`);
                    Object.values(events[day]).forEach(event => {
                        const eventElement = document.createElement('div');
                        eventElement.className = 'event';
                        eventElement.style.backgroundColor = event.color;
                        eventElement.textContent = `${event.title} (${event.startTime} - ${event.endTime})`;
                        eventsContainer.appendChild(eventElement);
                    });
                });
            }
        });
    }

    prevMonthButton.addEventListener('click', () => {
        if (currentMonth > 0) {
            currentMonth--;
        } else {
            currentMonth = 11;
            currentYear--;
        }
        updateCalendarHeader();
        generateCalendar();
    });

    nextMonthButton.addEventListener('click', () => {
        if (currentMonth < 11) {
            currentMonth++;
        } else {
            currentMonth = 0;
            currentYear++;
        }
        updateCalendarHeader();
        generateCalendar();
    });

    cancelEventButton.addEventListener('click', closeModal);

    updateCalendarHeader();
    generateCalendar();
</script>
</body>
</html>
